# 📘 2.3.2 애플리케이션 계층을 처리하는 기기

### 🔍 핵심 개념

#### 🧩 L7 스위치란?

> **L7 스위치**는 OSI 7계층 중 "애플리케이션 계층(7계층)"을 처리하는 네트워크 장비로,  
> **로드밸런서**로서의 역할도 수행하며 서버 부하를 효율적으로 분산시키는 장치입니다.

---

### ✅ 역할 및 기능

- 여러 장비를 연결해 데이터를 중계하고, 목적지에 맞는 포트로 신호 전송  
- 클라이언트 요청을 여러 서버로 분산 처리해 시스템 부하 감소  
- **URL, 서버, 캐시, 쿠키** 등을 기준으로 트래픽 분산  
- **바이러스, 불법 요청 필터링** 기능 및 트래픽 모니터링 지원  
- 서버 상태에 따라 **정기적인 헬스 체크(health check)** 수행하여  
  장애 발생 시 서버를 자동으로 제외함

📌 핵심 키워드:
- 트래픽 분산
- URL 기반 라우팅
- 필터링 기능
- 응용 프로그램 수준 처리

---

### ✅ 구조 예시

- 사용자 → L7 스위치 → 다수의 서버 → 데이터베이스  
- 스위치는 내부 로직에 따라 요청을 분산 처리하고,  
  백엔드 서버들의 응답을 사용자에게 반환

### 🖼️ L7 스위치 구조

![L7 스위치](images/kjm_L7%20스위치.png)

---

## 🔹 L4 스위치 vs L7 스위치

| 구분 | L4 스위치 | L7 스위치 |
|------|-----------|-----------|
| 계층 | 전송 계층 (Layer 4) | 애플리케이션 계층 (Layer 7) |
| 라우팅 기준 | IP, 포트 번호 | URL, HTTP 헤더, 쿠키 등 |
| 사용 예 | 스트리밍, 메시징 등 | 웹 요청 기반 로드밸런싱 |
| 필터링 기능 | X | O |
| 트래픽 분산 기준 | 포트 기반 | 컨텐츠, 요청 정보 기반 |
| 헬스 체크 방식 | 서버 상태 확인 | 서버 및 응답 조건까지 확인 가능 |

> 예시:  
> - AWS의 **ALB(Application Load Balancer)** → L7 스위치 기반  
> - AWS의 **NLB(Network Load Balancer)** → L4 스위치 기반

---

## 🔹 헬스 체크란?

> 로드밸런서가 백엔드 서버의 정상 동작 여부를 확인하는 절차

- 정기적인 요청 전송을 통해 서버의 상태 감지  
- 설정된 횟수 이상 응답이 없으면 해당 서버를 분산 대상에서 제외  
- TCP, HTTP 요청 등 다양한 방식 사용

💡 예시:
- TCP 요청을 보내 3-way 핸드셰이크가 정상 수행되면 "정상"으로 판단

---

## 🔹 로드밸런서를 이용한 서버 이중화

> 로드밸런서는 서버 2대 이상을 연결해 가상의 IP를 제공하고,  
> 장애가 발생해도 다른 서버로 트래픽을 자동 전환함으로써  
> **무중단 서비스**를 가능하게 합니다.

📌 동작 방식

1. 사용자들은 `0.0.0.0:12010`이라는 가상 IP로 접속  
2. 로드밸런서는 `0.0.0.0:12011`, `0.0.0.0:12012` 서버 중 하나로 분산 처리  
3. 하나의 서버가 장애 발생 시 나머지 서버로 요청 전환  
4. 사용자 입장에서는 서비스가 중단되지 않음

![서버 이중화 구조](images/kjm_서버%20이중화.png)

---

## 📘 용어 정리

| 용어           | 설명 |
|----------------|------|
| L7 스위치      | 애플리케이션 계층의 요청을 처리하고, URL/헤더/쿠키 기준으로 트래픽을 분산하는 네트워크 장비 |
| 로드밸런서     | 서버 간 트래픽을 균등하게 분산시켜 부하를 조절하는 장치 |
| 헬스 체크      | 서버의 정상 동작 여부를 정기적으로 점검해 장애 서버를 자동 제외하는 기능 |
| 이중화         | 서비스 안정성을 높이기 위해 동일한 기능을 하는 서버를 여러 개 두는 방식 |
| ALB            | Application Load Balancer, L7 기반 로드밸런서 (AWS) |
| NLB            | Network Load Balancer, L4 기반 로드밸런서 (AWS) |

---

### ✅ 정리

- L7 스위치는 애플리케이션 계층의 트래픽을 이해하고 분산 처리할 수 있음  
- URL, 쿠키, 헤더 등 다양한 기준으로 정교한 트래픽 제어가 가능  
- 로드밸런서를 활용해 장애 상황에서도 무중단 서비스를 제공  
- 클라우드 환경에서 ALB/NLB와 연계되어 사용됨
