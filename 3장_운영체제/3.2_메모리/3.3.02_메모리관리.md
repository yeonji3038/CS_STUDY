# 📘 메모리 관리 (Memory Management)

운영체제의 핵심 역할 중 하나는 **메모리 관리**입니다.  
한정된 메모리를 효율적으로 사용하여 성능을 극대화하는 것이 목표

---

## 가상 메모리 (Virtual Memory)

가상 메모리는 실제 메모리보다 **더 큰 메모리 공간을 사용하는 것처럼 보이게 만드는 기술**  
- **가상 주소(Virtual Address)**: 사용자 프로그램이 인식하는 주소  
- **물리 주소(Physical Address)**: 실제 메모리(RAM)의 주소  
- **MMU**(Memory Management Unit)에 의해 가상 주소 → 물리 주소로 변환됨  
- 주소 매핑 정보는 **페이지 테이블(Page Table)**로 관리  
- 성능 향상을 위해 **TLB**를 사용함

### 🔹 TLB (Translation Lookaside Buffer)
- 페이지 테이블을 캐싱하여 주소 변환 속도를 향상시키는 **고속 캐시 메모리**

---

## 스와핑 (Swapping)

스와핑은 **프로세스를 메모리에서 디스크(스왑 공간)로 이동시키거나 다시 불러오는 작업**
- 메모리가 부족할 때 사용됨
- 프로세스를 통째로 디스크로 내보냄 (swap out), 필요 시 다시 메모리로 불러옴 (swap in)

---

## ⚠️ 페이지 폴트 (Page Fault)

**필요한 페이지가 메모리에 없을 때** 발생하는 예외

### 🔹 관련 개념
- **페이지(Page)**: 가상 메모리의 최소 단위
- **프레임(Frame)**: 물리 메모리의 최소 단위

### 🔹 발생 과정
1. 프로세스가 특정 가상 주소에 접근
2. MMU가 페이지 테이블 확인
3. 해당 페이지가 메모리에 없으면 → 페이지 폴트 발생
4. 디스크에서 페이지 로드 → 메모리에 적재 → 페이지 테이블 갱신 → 명령어 재실행

---

## 스레싱 (Thrashing)

- 메모리에 너무 많은 프로세스를 올릴 경우, **지나치게 많은 페이지 폴트**가 발생하여 **계속 스와핑만 수행**하는 상황
- CPU 사용률이 낮아지고 성능 저하
- 해결 방법:
  - 물리 메모리 증설
  - SSD로 교체
  - OS 차원의 해결: 작업 세트, PFF

---

## 스레싱 방지 기법

### 🔹 작업 세트 (Working Set)
- 프로세스의 **최근 사용 페이지 집합**을 추적하여 메모리에 유지함
- 지역성(Locality)을 기반으로 필요한 페이지만 유지하여 스와핑 감소

### 🔹 PFF (Page Fault Frequency)
- 페이지 폴트 발생 빈도를 기반으로 **프레임 수를 동적으로 조절**
  - PFF ↑ → 프레임 증가
  - PFF ↓ → 프레임 감소

---

## 🧩 메모리 할당 기법

### 연속 할당 (Contiguous Allocation)
- 프로세스에 **연속된 메모리 공간**을 할당하는 방식

#### 고정 분할 방식
- 메모리를 고정된 크기로 나누어 관리  
- **내부 단편화** 발생 가능

#### 가변 분할 방식
- 프로세스 크기에 맞춰 **유동적으로 메모리 할당**  
- **외부 단편화** 발생 가능

#### 용어 정리
- **내부 단편화**: 할당된 공간 중 **사용하지 못하는 내부 여유 공간**
- **외부 단편화**: 사용하지 못하는 **작게 나뉜 여유 공간들**
- **홀(Hole)**: 비어 있는 메모리 블록

---

### 불연속 할당 (Non-contiguous Allocation)

#### 페이징 (Paging)
- 가상 메모리와 물리 메모리를 **동일한 크기의 블록**으로 나눔 (페이지 vs 프레임)
- 주소 변환이 필요함

#### 세그멘테이션 (Segmentation)
- 프로세스를 **논리적인 단위(코드, 데이터, 스택)**로 나누어 관리

#### 페이징 + 세그멘테이션
- 둘을 결합한 방식으로, 세그먼트 내부를 페이지로 나누는 기법

---

## 페이지 교체 알고리즘

스와핑을 최소화하기 위해 **어떤 페이지를 제거할지 결정**하는 알고리즘

### 🔹 오프라인 알고리즘
- 미래의 접근 정보를 안다고 가정한 이상적인 알고리즘 (OPT 등)

### 🔹 FIFO (First-In First-Out)
- 가장 먼저 들어온 페이지를 먼저 제거

### 🔹 LRU (Least Recently Used)
- 가장 오랫동안 사용되지 않은 페이지를 제거

※ 추가 알고리즘: LFU, Second Chance 등

---

## ✅ 요약
- 운영체제는 가상 메모리, 페이지, 프레임, 스와핑, 페이지 폴트 등의 기법으로 메모리를 관리함
- 효율적인 메모리 관리는 시스템 성능에 매우 중요
- Thrashing을 방지하기 위한 대표적인 전략: **작업 세트**, **PFF**
- 다양한 메모리 할당 및 페이지 교체 전략이 존재